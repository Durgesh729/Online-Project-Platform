<!DOCTYPE html>
<html>
<head>
    <title>Fix Authentication</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <h1>Authentication Fix Tool</h1>
    <p>This will create test users and fix authentication issues.</p>
    <button onclick="fixAuth()">Fix Authentication</button>
    <div id="output"></div>

    <script>
        const supabaseUrl = 'https://lylifxrrvrhzwmiirxnm.supabase.co'
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imx5bGlmeHJydnJoenhtaWlyeG5tIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzUyNzQwNzcsImV4cCI6MjA1MDg1MDA3N30.8qWJjQwQzQwQzQwQzQwQzQwQzQwQzQwQzQwQzQ'
        
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey)
        
        function log(msg) {
            document.getElementById('output').innerHTML += '<div>' + msg + '</div>'
            console.log(msg)
        }
        
        async function fixAuth() {
            log('🔧 Starting authentication fix...')
            
            const users = [
                { email: 'mentee@git-india.edu.in', password: 'password123', name: 'Test Mentee', role: 'mentee' },
                { email: 'mentor@git-india.edu.in', password: 'password123', name: 'Test Mentor', role: 'mentor' },
                { email: 'hod@git-india.edu.in', password: 'password123', name: 'Test HOD', role: 'hod' },
                { email: 'test@gmail.com', password: 'password123', name: 'Test User', role: 'mentee' }
            ]
            
            for (const user of users) {
                try {
                    log(`📝 Creating user: ${user.email}`)
                    
                    const { data, error } = await supabase.auth.signUp({
                        email: user.email,
                        password: user.password,
                        options: {
                            data: {
                                name: user.name,
                                role: user.role
                            }
                        }
                    })
                    
                    if (error) {
                        if (error.message.includes('already registered')) {
                            log(`✅ ${user.email} already exists`)
                        } else {
                            log(`❌ Error creating ${user.email}: ${error.message}`)
                        }
                    } else {
                        log(`✅ Successfully created: ${user.email}`)
                    }
                } catch (err) {
                    log(`❌ Unexpected error with ${user.email}: ${err.message}`)
                }
            }
            
            // Test authentication
            log('🧪 Testing authentication...')
            try {
                const { data, error } = await supabase.auth.signInWithPassword({
                    email: 'mentee@git-india.edu.in',
                    password: 'password123'
                })
                
                if (error) {
                    log(`❌ Authentication test failed: ${error.message}`)
                } else {
                    log(`✅ Authentication test successful!`)
                    log(`📧 User: ${data.user.email}`)
                    log(`👤 Name: ${data.user.user_metadata?.name}`)
                    log(`🎭 Role: ${data.user.user_metadata?.role}`)
                    
                    // Sign out
                    await supabase.auth.signOut()
                    log('🚪 Signed out after test')
                }
            } catch (err) {
                log(`❌ Authentication test error: ${err.message}`)
            }
            
            log('🎉 Authentication fix completed!')
            log('📋 You can now use these credentials:')
            log('• mentee@git-india.edu.in / password123')
            log('• mentor@git-india.edu.in / password123')
            log('• hod@git-india.edu.in / password123')
            log('• test@gmail.com / password123')
        }
    </script>
</body>
</html>
